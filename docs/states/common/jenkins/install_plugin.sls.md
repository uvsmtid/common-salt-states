
The `states/common/jenkins/install_plugin.sls` file corresponding to
the `common.jenkins.install_plugin` dot notation is actually not a state.
It contains [jinja macros](http://jinja.pocoo.org/docs/dev/templates/#macros)
to simplify state templates which install plugin for Jenkins.

## `jenkins_plugin_installation_macros` ##

Macro `jenkins_plugin_installation_macros` takes two parameters:
*   `registered_content_item_id` which specifies a key to [system_resources][1]
    dictionary defined in pillar. Using this key, macros can access all necessary
    information to download and install plugin;
*   `unique_suffix` to differentiate between state id if plugin is specified
    more than once in different state files.

In addition to the parameter, macros relies on [SLS id](http://docs.saltstack.com/en/latest/ref/states/highstate.html#id-declaration)
existing in the state file where this macro is used. The id must match
the following pattern:
```
{{ registered_content_item_id }}_jenkins_plugin_installation_prerequisite_{{ unique_suffix }}
```
The state function called under this id should be [cmd](http://docs.saltstack.com/en/latest/ref/states/all/salt.states.cmd.html).
Jenkins plugin installation steps depend on it which leaves user of
the marcos possibility define any requisite to be met before continuing
with installation, for example:
```
{% from 'common/jenkins/install_plugin.sls' import jenkins_plugin_installation_macros with context %}

include:
    - sls: common.jenkins.master
    - sls: common.jenkins.download_jenkins_cli_tool

{% set unique_suffix = 'whatever' %}

jenkins_maven-plugin_plugin_jenkins_plugin_installation_prerequisite_{{ unique_suffix }}:
   cmd.run:
        - name: "echo dummy"
        - require:
            # Normally, each Jenkins plugin should require Jenkins master
            # and downloaded CLI tool provided by Jenkins.
            - sls: common.jenkins.master
            - sls: common.jenkins.download_jenkins_cli_tool

{{ jenkins_plugin_installation_macros('jenkins_maven-plugin_plugin', unique_suffix) }}
```
This will make installation of Maven Project Plugin defined under `jenkins_maven-plugin_plugin`
key inside `system_resources` dictionary in pillar depend on
successful execution of two states `common.jenkins.master` and `common.jenkins.download_jenkins_cli_tool`.

On the other hand, the last step in plugin installation generated by `jenkins_plugin_installation_macros`
plugin follows this pattern and also calls `cmd` function:
```
install_jenkins_{{ registered_content_item_id }}_{{ unique_suffix }}
```
Use this SLS id make other (subsequent) steps depend on successful plugin installation.

[1]: /docs/pillars/system_resources/readme.md

